var nerdamer=function(){function a(b,c){var d="hash"===c;if(I(b)){var e="",f="",g="",h=b.group,i=b.value;if(!d){var j=b.multiplier;-1===j&&(g="-",j=1),1!==j&&(e=j);var k=b.power;1!==k&&(f=I(k)?a(k):k)}switch(h){case o:e="",i=-1===b.multiplier?1:b.multiplier,f="";break;case t:i=b.collectSymbols(a).join("+").replace("+-","-");break;case v:i=b.collectSymbols(a).join("+").replace("+-","-");break;case u:i=b.collectSymbols(function(b){var c=b.group;return c!==t&&c!==v||1!==b.power||1!==b.multiplier?a(b):P(a(b))}).join("*");break;case q:var l=b.previousGroup,m=b.power.group;l===t&&(i=b.collectSymbols(a).join("+").replace("+-","-")),l!==o&&l!==p&&l!==r&&(i=P(i)),m!==v&&m!==u&&m!==t&&1===b.power.multiplier||!f||(f=P(f))}return((h===v||h===t)&&(e&&1!==e||"-"===g)||(h===u||h===v||h===t)&&f&&1!==f||b.baseName===w)&&(i=P(i)),0>f&&(f=P(f)),e&&(e+="*"),f&&(f="^"+f),g+e+i+f}if(J(b)){for(var n=b.elements.length,s=[],x=0;n>x;x++)s.push(b.elements[x].text());return"["+s.join(",")+"]"}return b.toString()}function b(a){this.name=a}function c(a){this.symbol=a}function d(a){return this instanceof d?(isNaN(a)?("i"===a&&(this.isImgSymbol=!0),this.group=p,F(a),this.value=a,this.multiplier=1,this.power=1):(this.group=o,this.value="#",this.multiplier=Number(a)),this):new d(a)}function e(a,b,c,d,e,f){this.val=a,this.fn=b,this.precedence=c,this.left_assoc=d,this.is_prefix=e,this.is_postfix=f||!1}function f(a){this.val=a}function g(){function a(a){return n.PARSE2NUMBER?a:C.symfunction("parens",[a])}function c(a){return a.multiplier<0&&(a.multiplier*=-1),L(a)||Y(a.power)?a:C.symfunction(y,[a])}function g(a){return C.pow(a,new d("0.5"))}function j(a){var b;if("e"===a.value)b=new d(a.power);else if(a.group===r&&"exp"===a.baseName){var c=a.args[0];b=1===a.multiplier?C.multiply(c,new d(a.power)):C.symfunction("log",[a])}else if(n.PARSE2NUMBER&&L(a)){var e;a.multiplier<0&&(a.negate(),e=C.multiply(new d(Math.PI),new d("i"))),b=new d(Math.log(a.multiplier)),e&&(b=C.add(b,e))}else b=C.symfunction("log",arguments);return b}function k(){return new h([].slice.call(arguments))}function l(){return i.fromArray(arguments)}function m(a){return K(a)?a.determinant():a}function s(a,b){return J(a)&&J(b)?a.dot(b):void E("function dot expects 2 vectors")}function z(a){return K(a)?a.transpose():void E("function transpose expects a matrix")}function A(a){return K(a)?a.invert():void E("invert expects a matrix")}var C=this,D={},F=this.constants={},H={"^":new e("^","pow",4,!1,!1),"*":new e("*","multiply",3,!0,!1),"/":new e("/","divide",3,!0,!1),"+":new e("+","add",2,!0,!0),"-":new e("-","subtract",2,!0,!0),",":new e(",","comma",1,!0,!1)},N=this.functions={cos:[,1],sin:[,1],tan:[,1],sec:[,1],csc:[,1],cot:[,1],acos:[,1],asin:[,1],atan:[,1],exp:[,1],min:[,-1],max:[,-1],erf:[,1],floor:[,1],ceil:[,1],fact:[,1],round:[,1],mod:[,2],step:[,1],sign:[,1],rect:[,1],sinc:[,1],tri:[,1],re:[,1],im:[,1],vector:[k,-1],matrix:[l,-1],parens:[a,-1],sqrt:[g,1],log:[j,1],abs:[c,1],invert:[A,1],transpose:[z,1],dot:[s,2]},P={},Q=function(a){return a[a.length-1]},T="(",U=")",V="[",W="]",X=[];P[T]=T,P[U]=U,P[V]=V,P[W]=W,this.error=E,this.override=function(a,b){D[a]||(D[a]=[]),D[a].push(this[a]),this[a]=b},this.restore=function(a){this[a]&&(this[a]=D[a].pop())},this.extend=function(a,b,c){var d=this,e=this[a];if("function"==typeof e&&"function"==typeof b){var f=this[a];this[a]=function(a,e){return I(a)&&I(e)&&!c?f.call(d,a,e):b.call(d,a,e,f)}}},this.symfunction=function(a,b){var c=new d(a);return c.group=r,"object"==typeof b&&(b=[].slice.call(b)),c.args=b,c.baseName=a,c.updateHash(),c},this.callfunction=function(a,b){var c=N[a];if(!c)throw new Error(a+" is not a supported function.");var e,f=c[1],g=c[0];if(b instanceof Array||(b=void 0!==b?[b]:[]),-1!==f){var h=M(f),i=h?f[0]:f,j=h?f[1]:f,k=b.length,l=a+" requires a {0} of {1} arguments. {2} provided!";i>k&&E(S(l,"minimum",i,k)),k>j&&E(S(l,"maximum",j,k))}if(g)e=g.apply(c[2]||this,b);else if(n.PARSE2NUMBER)try{b=b.map(function(a){return a.group===o?a.multiplier:void E("Symbol must be of group N.")});var m=Math[a]?Math[a]:ga[a];e=new d(m.apply(void 0,b))}catch(p){var q=["exp","re","im"];e=-1!==q.indexOf(a)?ga[a].apply(void 0,b):this.symfunction(a,b)}else e=this.symfunction(a,b);return e},this.powerAdd=function(a,b,c){var e=!isNaN(b);if(!e||c||I(a.power)){var f=I(b)?b:new d(b);a.power=C.add(a.power,f)}else a.power+=b;0===a.power.valueOf()&&a.convert(o)},this.parse=function(a,c){a=G(a),a=String(a).split(" ").join("").replace(/\d*\.*\d+e[\+\-]*\d+/gi,function(a,b,c){return/[a-z_]/.test(c.charAt(b-1))?a:(X.push(a),"&")}).replace(/([\+\-\/\*]*[0-9]+)([a-z_]+[\+\-\/\*]*)/gi,function(){var a=arguments[4],b=arguments[1],c=arguments[2],d=arguments[3],e=a.charAt(d),f="",g="*";return e.match(/[\+\-\/\*]/)||(f=a.charAt(d-1)),f.match(/[a-z]/i)&&(g=""),b+g+c}).replace(/\)\(/g,")*(");var e,g,i,j=c||{},k=[],l=[],m=a.length,n=0,o=!1,p=!1,q=0,r=function(a){a||(a=k.pop());var b=l.pop(),c=l.pop();if(a||c||!b)if(a===T)o&&E("Unmatched open parenthesis!"),k.push(a),s(c),s(b);else{var e,f=a.fn;e=f?c.multiplier===1/0||b.multiplier===1/0?new d(1/0):C[f].call(C,c,b):a.resolve(b),s(e)}else s(b)},s=function(b){if(/&/.test(b)&&(b=X.shift()),""!==b&&void 0!==b){if(!(b instanceof Array||b instanceof d||R(b))){var c=j[b]||B[b];b=c?c.copy():new d(b)}var e=Q(l);if(J(b)){var g=Q(k);if(J(e)){if(!g||","!==g.val){b.elements.length>2&&E("Incorrect number of indices!"),l.pop();var i=b.elements[0]-1,m=b.elements[1];b=void 0!==m?new h(e.elements.slice(i,m)):e.elements[i],b||E("Index out of range!")}}else!g&&e&&E(e+" is not a vector")}for(;Q(k)instanceof f;){if(p){var n=H[a.charAt(q+1)];if(n&&!n.left_assoc)break}if(v&&!v.left_assoc)break;var o=k.pop();b=o.resolve(b)}l.push(b),p=!1}};if(!j["~"])for(var t in F)j[t]=new d(F[t]);for(q=0;m>q;q++){var u=a.charAt(q),v=H[u],w=P[u];if(v||w){var y=a.substring(n,q);if(w===T&&y||w===V){w===V&&y&&s(y);var z=w===V?x:y;k.push(new b(z),T),n=q+1,e=q;continue}if(s(y),!w&&(q-e===1||0===q)){if(v.is_prefix){k.push(new f(v.val)),n=q+1,e=q;continue}E(v.val+" is not a valid prefix operator!:"+n)}if(u!==U&&(e=q),v){if(g&&(v.left_assoc&&v.precedence<=g.precedence||!v.left_assoc&&v.precedence<g.precedence)){var A=!1;do{r();var D=Q(k);if(D===T)break;A=D?D.left_assoc&&D.precedence<v.precedence:!0}while(!A)}k.push(v),g=Q(k)}else{if(u===T)k.push(w);else if(u===U||u===W){e=null;for(var I=!1;!I;){var K=k.pop();if(void 0===K&&E("Unmatched close bracket or parenthesis!"),K===T?I=!0:r(K),K===T&&u===W){var L=Q(k);L&&L.name===x||E("Unmatched parenthesis!")}}var M=Q(k);if(M instanceof b){M.name===x&&u!==W&&E("Unmatched bracket!");var N=C.callfunction(k.pop().name,l.pop());p=!0,s(N)}}g=Q(k)}n=q+1}else q===m-1&&s(a.substring(n,q+1));i=u}for(o=!0;k.length>0;)r();return l[0]},this.ext={log:j,sqrt:g,abs:c,vector:k,matrix:l,parens:a,determinant:m,dot:s,invert:A,transpose:z},this.mapped_function=function(){for(var a={},b=this.params,c=0;c<b.length;c++)a[b[c]]=arguments[c];return C.parse(this.body,a)},this.unpack=function(a){if(1===a.power){var b=a.args[0];b.multiplier*=a.multiplier,a=b}return a},this.add=function(a,b){var c,e=I(a),f=I(b);if(e&&f){var g=a.group,h=b.group;if(0===a.multiplier)return b;if(0===b.multiplier)return a;if(g===r&&a.baseName===w&&(a=this.unpack(a)),h===r&&a.baseName===w&&(b=this.unpack(b)),g>h)return this.add(b,a);if(n.SAFE&&(a=a.copy(),b=b.copy()),a.value!==b.value||g===v&&a.power!==b.power)if(h===v)if(g===v){if(a.power>b.power){var c=a;a=b,b=c}if(a.value===b.value)a.convert(t),a.attach(b);else if(1===a.power)if(1===b.power){var j;a.distributeMultiplier(),b.distributeMultiplier();for(j in b.symbols)this.add(b.symbols[j],a)}else a.attach(b);else{var k=new d("blank");k.symbols={},k.length=1,k.group=v,k.attach(a),k.attach(b),a=k}}else if(1===b.power){if(1===b.multiplier)b.attach(a);else{for(var j in b.symbols)b.symbols[j].multiplier*=b.multiplier;b.multiplier=1,b.attach(a)}a=b}else a.convert(v),a.attach(b);else a.convert(v),a.attach(b);else if(a.power===b.power&&h!==t||g===q&&a.equals(b))a.multiplier+=b.multiplier,0===a.multiplier&&(a=d(0));else if(h===t)if(g===t)if(1===a.power&&1===b.power){a.distributeMultiplier(),b.distributeMultiplier();for(var j in b.symbols)a.attach(b.symbols[j])}else if(a.power===b.power)a.multiplier+=b.multiplier;else{if(a.power>b.power){var c=a;a=b,b=c}a.convert(v),a.attach(b)}else{if(1===b.multiplier)b.attach(a);else{for(var j in b.symbols)b.symbols[j].multiplier*=b.multiplier;b.multiplier=1,b.attach(a)}a=b}else a.convert(t),a.attach(b);if((a.group===v||a.group===t)&&1===a.length)for(var l in a.symbols){var m=a.symbols[l];m.multiplier*=a.multiplier,a=m}return a}f&&!e&&(c=a,a=b,b=c,c=f,f=e,e=c);var o=K(b),p=K(a);if(e&&o)b.eachElement(function(b){return C.multiply(a.copy(),b)});else if(p&&o){var s=a.rows();new i;s===b.rows()&&a.cols()===b.cols()?b.eachElement(function(b,c,d){return C.add(b,a.elements[c][d])}):C.error("Matrix dimensions do not match!")}else e&&J(b)?b.each(function(c,d){d--,b.elements[d]=C.multiply(a.copy(),b.elements[d])}):J(a)&&J(b)?b.each(function(c,d){d--,b.elements[d]=C.multiply(a.elements[d],b.elements[d])}):J(a)&&K(b)?(a=new i(a.elements),b=a.multiply(b)):K(a)&&J(b)&&(b=new i(b.elements),b=a.multiply(b));return b},this.subtract=function(a,b){var c,d=d=I(a),e=I(b);if(d&&e)return this.add(a,b.negate());if(e&&(c=b,b=a,a=c,d=e),d&&J(b))b=b.map(function(b){return C.subtract(b,a.copy())});else if(J(a)&&J(b))a.dimensions()===b.dimensions()?b=a.subtract(b):C.error("Unable to subtract vectors. Dimensions do not match.");else if(K(a)&&K(b)){var f=a.rows();f===b.rows()&&a.cols()===b.cols()?b.eachElement(function(b,c,d){return C.subtract(b,a.elements[c][d])}):C.error("Matrix dimensions do not match!")}return b},this.multiply=function(a,b){var c,e=I(a),f=I(b);if(e&&f){if(0===a.multiplier||0===b.multiplier)return new d(0);var g=a.group,h=b.group,j=!1;if(g===r&&a.baseName===w&&(a=this.unpack(a)),h===r&&a.baseName===w&&(b=this.unpack(b)),a.isImgSymbol&&b.isImgSymbol){var k=a.power+b.power===0?1:-1;return new d(k*a.multiplier*b.multiplier)}if(g>h)return this.multiply(b,a);if(n.SAFE&&(a=a.copy(),b=b.copy()),O(a.power)&&O(b.power)&&(j=!0,a.invert(),b.invert()),g===o)b.multiplier*=a.multiplier;else if(a.value===b.value){if(g===p&&h===q)b.previousGroup===t?(b.convert(u),b.combine(a)):b.power=C.add(b.power,d(a.power));else if(g===q)if(h===t)b.convert(u),b.combine(a);else{var l=a.previousGroup,m=b.previousGroup;if(l===p||l===o||l===r){var s=a.power,x=b.power;b.group!==q&&(x=new d(x),b=a),b.power=C.add(s,x)}else if(l===t&&l===m)a.keyForGroup(u)!==b.keyForGroup(u)?(b.convert(u),b.combine(a)):b.power=C.add(b.power,a.power);else if(h===q)b.power=C.add(a.power,b.power);else{var y=new d(b.power);a.power=C.add(a.power,y),b=a}}else if(h===t)if(b.distributeMultiplier(),g!==t)if(1===b.power){var z=b.copy();z.symbols={},z.length=0;for(var A in b.symbols){var B=$(b.symbols,A),D=C.multiply(a,B);D.value!==z.value&&(z.group=v),z.attach(D)}b=z}else b.convert(u),b.combine(a);else a.value===b.value?b.power+=a.power:(b.convert(u),b.combine(a));else b.power+=a.power;b.multiplier*=a.multiplier,0===Number(b.power)&&(b=d(b.multiplier))}else if(g===u&&h===u){if(a.distributeExponent(),b.distributeExponent(),1===a.power&&1!==b.power){var c=a;a=b,b=c}if(1===a.power&&1===b.power){b.multiplier*=a.multiplier;for(var A in a.symbols)b.combine(a.symbols[A])}else if(1===b.power)b.attach(a);else{var A=new d("x");A.symbols={},A.group=u,A.combine(a),A.combine(b),b=A}}else h===u?(b.distributeExponent(),b.combine(a)):g===p&&h!==u?(a.convert(u),a.combine(b),b=a):g===u?(a.combine(b),b=a):(b.convert(u),b.combine(a));if(b.group===u&&1===b.length)for(var E in b.symbols){var B=b.symbols[E];B.multiplier*=b.multiplier,b=B}return j&&b.invert(),b}f&&!e&&(c=a,a=b,b=c,c=f,f=e,e=c);var F=K(b),G=K(a);return e&&F?b.eachElement(function(b){return C.multiply(a.copy(),b)}):G&&F?b=a.multiply(b):e&&J(b)?b.each(function(c,d){d--,b.elements[d]=C.multiply(a.copy(),b.elements[d])}):J(a)&&J(b)?b.each(function(c,d){d--,b.elements[d]=C.multiply(a.elements[d],b.elements[d])}):J(a)&&K(b)?(a=new i(a.elements),b=a.multiply(b)):K(a)&&J(b)&&(b=new i(b.elements),b=a.multiply(b)),b},this.divide=function(a,b){var c=c=I(a),d=I(b);if(c&&d)return 0===b.multiplier&&E("Division by zero!"),this.multiply(a,b.invert());var e=J(a),f=J(b);if(c&&f)b=b.map(function(b){return C.divide(a.copy(),b)});else if(e&&d)b=a.map(function(a){return C.divide(a,b.copy())});else if(e&&f)a.dimensions()===b.dimensions()?b=b.map(function(b,c){return C.divide(a.elements[--c],b)}):C.error("Cannot divide vectors. Dimensions do not match!");else{var g=K(a),h=K(b);g&&d?(a.eachElement(function(a){return C.divide(a,b.copy())}),b=a):g&&h?a.rows()===b.rows()&&a.cols()===b.cols()?a.eachElement(function(a,c,d){return C.divide(a,b.elements[c][d])}):C.error("Dimensions do not match!"):g&&f&&(a.cols()===b.dimensions()?(a.eachElement(function(a,c,d){return C.divide(a,b.elements[c].copy())}),b=a):C.error("Unable to divide matrix by vector."))}return b},this.pow=function(a,b){var c=I(a),e=I(b);if(c&&e){var f=Number(b);if(1===f)return a;if(0===f)return 0===Number(a)&&E("Division by zero!"),new d(1);var g=a.group,h=b.group;if(n.SAFE&&(a=a.copy(),b=b.copy()),g!==q&&h===o){var i=b.multiplier;if(1!==i)if(0===i)b.mutiplier=1,a=b;else{var j=Y(i),k=a.multiplier<0,l=Y(a.power),m=Math.abs(i%1)>0;if(g===o){var p=k&&m;p&&(a.multiplier*=-1),a.multiplier=Math.pow(a.multiplier,i),p&&(a=this.multiply(a,new d("i")),0>i&&a.negate())}else{var s=a.multiplier,t=Math.pow(Math.abs(s),i),v=Math.abs(s)/s;if(a.power*=i,a.multiplier=t,k&&!j&&(a.multiplier*=v),m&&k){var x=-a.multiplier;if(l)a.multiplier=1,Y(a.power)||(a=this.symfunction(y,[a])),a=this.multiply(new d("i"),a);else{var z=a.power;a.multiplier/=x,a.power/=z,a=this.symfunction(w,[a]),a.power=z}a.multiplier=x}if(l&&m&&!Y(a.power)){var z=a.power;a.power=1,a=C.symfunction(y,[a]),a.power=z}if(a.group===r&&a.baseName===y){var t=a.args[0],A=a.power*t.power;Y(A)&&(t.power=A,t.multiplier=a.multiplier*Math.pow(t.multiplier,a.power),a=t)}}}if(a.group===u){var z=a.power;for(var B in a.symbols)a.symbols[B].power*=z;a.power=1}}else{var x,D=a.power;I(D)||(D=new d(D||1)),1!==a.multiplier&&(x=new d(a.multiplier),a.multiplier>=0?x.convert(q):(x.group=q,x.value=x.multiplier,x.multiplier=1),x.power=b.copy(),a.multiplier=1),a.group!==q&&a.convert(q),a.power=this.multiply(D,b),a.power.isOne()&&(a.group=a.previousGroup,delete a.previousGroup,a.power=1),x&&(a=this.multiply(a,x))}return a}return J(a)&&e?a=a.map(function(a){return C.pow(a,b.copy())}):K(a)&&e&&a.eachElement(function(a){return C.pow(a,b.copy())}),a},this.comma=function(a,b){return a instanceof Array?a.push(b):a=[a,b],a}}function h(a){J(a)?this.elements=a.items.slice(0):M(a)?this.elements=a.slice(0):this.elements=[].slice.call(arguments)}function i(){var a,b=arguments,c=b.length,d=[];if(K(b))for(a=0;c>a;a++)d.push(b[a].slice(0));else{var e,f,g;for(a=0;c>a;a++){if(e=b[a],J(e)&&(e=e.elements),M(e)||(e=[e]),g=e.length,f&&f!==g)throw new Error("Unable to create Matrix. Row dimensions do not match!");d.push(e),f=g}}this.elements=d}var j="0.5.8",k=new g,l={},m={},n={exclude:[],suppress_errors:!1,PARSE2NUMBER:!1,SAFE:!1},o=l.N=1,p=l.S=2,q=l.EX=3,r=l.FN=4,t=l.PL=5,u=l.CB=6,v=l.CP=7,w="parens",x="vector",y="abs",z=[],A=[],B={},C=[],D=m.isReserved=function(a){return-1!==C.indexOf(a)},E=function(a){if(!n.suppress_errors)throw new Error(a)},F=m.validateName=function(a,b){b=b||"variable";var c=/^[a-z_][a-z\d\_]*$/gi;if(!c.test(a))throw new Error(a+" is not a valid "+b+" name")},G=m.insertFactorial=function(a){var b,c=/(\d+|\w+)!/gi;do b=c.exec(a),null!==b&&(a=a.replace(b[0],"fact("+b[0]+")").expression.replace("!",""));while(b);return a},H=m.isFraction=function(a){return I(a)?H(a.multiplier):a%1!==0},I=m.isSymbol=function(a){return a instanceof d},J=m.isVector=function(a){return a instanceof h},K=m.isMatrix=function(a){return a instanceof i},L=m.isNumericSymbol=function(a){return a.group===o},M=m.isArray=function(a){return a instanceof Array},N=m.isInt=function(a){return a%1===0},O=m.isNegative=function(a){return I(a)&&(a=a.multiplier),0>a},P=(m.isComposite=function(a){return a.group===t||a.group===v},m.inBrackets=function(a){return"("+a+")"}),Q=m.stringReplace=function(a,b,c,d){return a.substr(0,b)+d+a.substr(c,a.length)},R=m.customType=function(a){return void 0!==a&&a.custom},S=(m.sameSign=function(a,b){return 0>a==0>b},m.format=function(){var a=[].slice.call(arguments),b=a.shift();return b.replace(/{(\d+)}/g,function(b,c){var d=a[c];return"function"==typeof d?d():d})}),T=m.keys=function(a){var b=[];for(var c in a)b.push(c);return b},U=m.firstObject=function(a){for(var b in a)break;return a[b]},V=(m.arrayMax=function(a){return Math.max.apply(void 0,a)},m.arrayMin=function(a){return Math.min.apply(void 0,a)},m.round=function(a,b){return b=b||14,Math.round(a*Math.pow(10,b))/Math.pow(10,b)},m.insertArray=function(a,b,c,d){if(d=d===!1?d:!0,M(b)&&d)for(var e=0;e<=b.length+1;e++)V(a,b.pop(),c);else"undefined "==typeof c?a.push(b):a.splice(c,0,b)}),W=m.variables=function(a,b){if(b=b||{c:[],add:function(a){-1===this.c.indexOf(a)&&isNaN(a)&&this.c.push(a)}},I(a)){var c=a.group,d=a.previousGroup;if(c===v||c===u||d===v||d===u)for(var e in a.symbols)W(a.symbols[e],b);else if(c===p)b.add(a.value);else if(c===t)W(U(a.symbols),b);else if(c===q)isNaN(a.value)||b.add(a.value),W(a.power,b);else if(c===r)for(var f=0;f<a.args.length;f++)W(a.args[f],b)}return b.c.sort()},X=m.each=function(a,b){if(M(a))for(var c=a.length,d=0;c>d;d++)b.call(a,d);else for(var e in a)a.hasOwnProperty(e)&&b.call(a,e)},Y=m.even=function(a){return a%2===0},Z=(m.evenFraction=function(a){return 1/(a%1)%2===0},m.arrayUnique=function(a){for(var b=a.length,c=[],d=0;b>d;d++){var e=a[d];-1===c.indexOf(e)&&c.push(e)}return c},m.reserveNames=function(a){var b=function(a){-1===C.indexOf(a)&&C.push(a)};"string"==typeof a?b(a):X(a,function(a){b(a)})}),$=m.remove=function(a,b){var c;return M(a)?c=a.splice(b,1)[0]:(c=a[b],delete a[b]),c},_=m.block=function(a,b,c,d){var e=n[a];n[a]=void 0===c?!0:!!c;var f=b.call(d);return n[a]=e,f},aa=(m.arguments2Array=function(a){return[].slice.call(a)},function(a,b,c,d){d=d||0;for(var e,f=c.length,g=0,h=d;f>h;h++){var i=c.charAt(h);if(i===a&&(void 0===e&&(e=h+1),g++),i===b&&(g--,0===g&&void 0!==e)){var j=h;return[c.substring(e,j),e,j]}}return[]}),ba=function(a){for(var b in a)a[b]=k.parse(a[b].toString());return a},ca=function(a){s=a;for(var b=z.length,c=0;b>c;c++){var d=z[c];"function"==typeof d&&(s=d(s))}return s},da=m.eachaddsymbol=function(a){var b=[];return a.group===u||a.group===q||0===a.collectSymbols().length?[a]:(a.collectSymbols().forEach(function(a,c,d){b.push.apply(b,da(a))}),b)},ea=m.eachmuiltisymbol=function(a){var b=[];return 0===a.collectSymbols().length?1===a.multiplier?[a]:[a,new d(a.multiplier)]:(a.collectSymbols().forEach(function(a,c,d){b.push.apply(b,ea(a))}),1!==a.multiplier&&b.push(new d(a.multiplier)),b)},fa=(m.isSingleVariable=function(a){return a.group===p&&1===a.multiplier&&1===a.power},m.hasVariable=function(a,b){return-1!==a.text().indexOf(b.text())},m.joinmuiltisymbols=function(a){return a.reduce(function(a,b){return k.multiply(a,b)})},m.joinaddsymbols=function(a){return a.reduce(function(a,b){return k.add(a,b)})}),ga={csc:function(a){return 1/Math.sin(a)},sec:function(a){return 1/Math.cos(a)},cot:function(a){return 1/Math.tan(a)},erf:function(a){for(var b=1,c=1,d=1*a,e=1;50>e;e++)b*=e,c*=-1,d+=c*Math.pow(a,2*e+1)/(b*(2*e+1));return 2*d/Math.sqrt(3.14159265358979)},fact:function(a){for(var b=1,c=2;a>=c;c++)b*=c;return b},mod:function(a,b){return a%b},GCD:function(){for(var a=[].slice.call(arguments).map(function(a){return Math.abs(a)}).sort(),b=Math.abs(a.shift()),c=a.length;c-->0;)for(var d=Math.abs(a.shift());;){if(b%=d,0===b){b=d;break}if(d%=b,0===d)break}return b},step:function(a){return a>0?1:0>a?0:.5},rect:function(a){return.5==a||a==-.5?.5:Math.abs(a)<.5?1:0},sinc:function(a){return 0==a?1:a==1/0||a==-(1/0)?0:Math.sin(a)/a},tri:function(a){return Math.abs(a)<1?1-Math.abs(a):0},re:function(a){if(!I(a))return a;if(!L(a)){var b=da(a);return b=b.filter(function(a){return-1===a.text().indexOf("i")}),0===b.length?new d("0"):fa(b)}return a},im:function(a){if(!I(a))return 0;if(!L(a)){var b=da(a);return b=b.filter(function(a){return-1!==a.text().indexOf("i")}),b.forEach(function(a,b,c){c[b]=k.divide(a,new d("i"))}),0===b.length?new d("0"):fa(b)}return 0},exp:function(a){if(!L(a)){if(-1!==a.text().indexOf("i")){var b=m.format("(e^({0}))*(cos({1}) + i*sin({1}))",ga.re(a),ga.im(a));return k.parse(b)}return k.symfunction("exp",[a])}return Math.exp(a)},sign:function(a){return a>0?1:0>a?-1:0}};Z(ga),m.text=a,c.getExpression=function(a,b){"last"!==a&&a||(a=A.length),"first"===a&&(a=1);var d=a-1,e=A[d],f=e?new c(e):e;return f},c.prototype={text:function(){return this.symbol.text("final")},latex:function(){return ia.latex(this.symbol)},valueOf:function(){return this.symbol.valueOf()},evaluate:function(){var a,b=arguments[0],d=1;"string"==typeof b?a="%"===b.charAt(0)?c.getExpression(b.substr(1)).text():b:b instanceof c||I(b)?a=b.text():(a=this.symbol.text(),d--);var e=void 0!==arguments[d]?arguments[d]:{};return e.PI=Math.PI,e.E=Math.E,new c(_("PARSE2NUMBER",function(){return k.parse(a,ba(e))},!0))},buildFunction:function(a){return ka(this.symbol,a)},isNumber:function(){return L(this.symbol)},isInfinity:function(){return Math.abs(this.symbol.multiplier)===1/0},variables:function(){return W(this.symbol)},toString:function(){return this.symbol.text()},isMonomial:function(){return this.symbol.group===p},isFraction:function(){return H(this.symbol)},isPolynomial:function(){return this.symbol.isPoly()}},d.prototype={coeffs:function(){var a=[];if(this.symbols)for(var b in this.symbols)a.push(this.symbols[b].multiplier);else a.push(this.multiplier);return a},equals:function(b){return this.value===b.value&&a(this.power)===a(b.power)},isPoly:function(a,b){var c=!1;if(this.group===p&&this.power>0||this.group===o)c=!0;else{var d=T(this.symbols).sort(),e=d.length;if(2===e&&"#"===d[0])c=this.symbols[d[1]].isPoly(a,b);else if(this.group===v&&b){c=!0;for(var f in this.symbols){var g=this.symbols[f],h=g.group;if(h===r||h===q?c=!1:(h===t||h===v)&&(c=g.isPoly(a,b)),!c)break}}else if(this.group===t){c=!0;for(var i=0;e>i;i++){var j=d[i];if(c=!isNaN(j),a||(c=!(0>j)),!c)break}}}return c},isInverse:function(){return this.group===q?this.power.multiplier<0:this.power<0},copy:function(){var a,b=new d(0),c=["multiplier","value","group","length","previousGroup","isImgSymbol","baseName","args"],e=c.length;if(this.symbols){b.symbols={};for(var f in this.symbols)b.symbols[f]=this.symbols[f].copy()}for(a=0;e>a;a++)void 0!==this[c[a]]&&(b[c[a]]=this[c[a]]);return this.power&&(b.power=I(this.power)?this.power.copy():this.power),b},each:function(a){for(var b in this.symbols)a.call(this,this.symbols[b],b)},valueOf:function(){return this.group===o?this.multiplier:0===this.power?1:0===this.multiplier?0:a(this)},contains:function(a,b){var c=this.group;if(this.symbols){for(var d in this.symbols)if(this.symbols[d].contains(a,b))return!0}else if(c===r||this.previousGroup===r){for(var e=0;e<this.args.length;e++)if(this.args[e].contains(a,b))return!0}else if(c===q)return b&&this.power.contains(a,b)?!0:this.value===a;return this.value===a},negate:function(){return this.multiplier*=-1,(this.group===v||this.group===t)&&this.distributeMultiplier(),this},invert:function(a){return a||(this.multiplier=1/this.multiplier),I(this.power)?this.power.negate():this.power&&(this.power*=-1),this},distributeMultiplier:function(){if(this.symbols&&1===this.power&&this.group!==u){for(var a in this.symbols){var b=this.symbols[a];b.multiplier*=this.multiplier,b.distributeMultiplier()}this.multiplier=1}return this},distributeExponent:function(){if(1!==this.power){var a=this.power;for(var b in this.symbols){var c=this.symbols[b];c.group===q?c.power=k.multiply(c.power,new d(a)):this.symbols[b].power*=a}this.power=1}return this},convert:function(a){if(a>r){var b=this.copy();this.symbols={},a===u?b.multiplier=1:this.multiplier=1,this.group===r&&(b.args=this.args,delete this.args,delete this.baseName),this.isImgSymbol&&delete this.isImgSymbol,this.power=1,this.symbols[b.keyForGroup(a)]=b,this.group=a,this.length=1}else if(a===q)(this.group!==o||1!==this.multiplier)&&(this.previousGroup=this.group,this.group===o&&(this.value=this.multiplier,this.multiplier=1),this.group=q);else if(a===o){for(var c in this)this.hasOwnProperty(c)&&"value"!==c&&"multiplier"!==c&&delete this[c];this.value="#",this.group=o}},insert:function(a,b){if(I(a)||E("Object "+a+" is not of type Symbol!"),this.symbols){var c=this.group;if(c>r){var d=a.keyForGroup(c),e=this.symbols[d];if("add"===b){var f=d;e?(this.symbols[f]=k.add(e,a),0===this.symbols[f].multiplier&&(delete this.symbols[f],this.length--,0===this.length&&(this.convert(o),this.multiplier=0))):(this.symbols[d]=a,this.length++)}else if(e&&(a=k.multiply($(this.symbols,d),a),0===this.length&&this.convert(o),this.length--),this.multiplier*=a.multiplier,a.multiplier=1,1!==Math.abs(a.valueOf())){if(1!==this.power){var g=this.copy();g.multiplier=1,this.power=1,this.symbols={};var h=g.keyForGroup(u);this.symbols[h]=g}this.symbols[d]=a,this.length++}(this.group===v||this.group===u)&&this.updateHash()}}},attach:function(a){this.insert(a,"add")},combine:function(a){this.insert(a,"multiply")},updateHash:function(){if(this.group===r){for(var b="",c=this.args,d=this.baseName===w,e=0;e<c.length;e++)b+=(0===e?"":",")+a(c[e]);var f=d?"":this.baseName;this.value=f+(d?b:P(b))}else this.group!==p&&this.group!==t&&(this.value=a(this,"hash"))},keyForGroup:function(b){var c=this.group;return c===o?this.value:c===p?b===t?this.power:this.value:c===r?b===t?this.power:a(this,"hash"):c===t?b===u?a(this,"hash"):b===v?1===this.power?this.value:P(a(this,"hash"))+"^"+this.power:this.value:c===v?b===v?a(this,"hash"):b===t?this.power:this.value:c===u?b===t?this.power:a(this,"hash"):c===q?b===t?a(this.power):a(this,"hash"):void 0},collectSymbols:function(a){var b=[];for(var c in this.symbols){var d=this.symbols[c];b.push(a?a(d):d)}return b.sort()},latex:function(){return ia.latex(this)},text:function(){return a(this)},isOne:function(){return this.group===o?1===this.multiplier:0===this.power},getDenom:function(){if(this.group===u)for(var a in this.symbols)if(this.symbols[a].power<0)return this.symbols[a]},toString:function(){return this.text()}},f.prototype={resolve:function(a){return"-"===this.val?a.negate():a}};var ha={convert:function(a,b){var c;if(0===a)c=[0,1];else if(1e-6>a||a>1e20){var d=this.quickConversion(Number(a));if(d[1]<=1e20){var e=Math.abs(a),f=a/e;c=this.fullConversion(e.toFixed((d[1]+"").length-1)),c[0]=c[0]*f}else c=d}else c=this.fullConversion(a);return c},quickConversion:function(a){var b=(a.toExponential()+"").split("e"),c=b[0].split(".")[1],d=c?c.length:0;return[Math.pow(10,d)*b[0],Math.pow(10,Math.abs(b[1])+d)]},fullConversion:function(a){for(var b=!1,c=0,d=1,e=1,f=0,g=0,h=a,i=1e-13;!b;){g++,g>1e4&&(b=!0);var j=parseInt(h),k=c+j*e,l=d+j*f,m=h-j;i>m&&(b=!0),h=1/m,c=e,d=f,e=k,f=l,(Math.abs(k/l-a)<i||g>30)&&(b=!0)}return[k,l]}},ia={space:"~",latex:function(a,b,c,d){b=b||!1,c=c||a.group;var e,f="";this.inBraces;if(I(a))switch(c){case o:if(e=a.multiplier,b&&(e=Math.abs(e)),N(e))f=e;else if(Math.abs(e)===1/0)f="\\infty",e===-(1/0)&&(f="-"+f);else{var g=ha.convert(e);f=this.fraction(g)}break;case p:if("PI"===a.value){f=this.renderSymbolLatex(a,"\\pi",b);break}f=this.renderSymbolLatex(a,void 0,b);break;case r:var h=a.baseName;h===w?h="":(h in Math||h in ga)&&(h="\\"+h);var i=a.args.slice(0).map(function(a){return ia.latex(a)});e="\\abs"===h?"\\left|"+i+"\\right|":h+this.inBrackets(i),f=this.renderSymbolLatex(a,e,b);break;case t:var e=this.renderSubSymbolsLatex(a,function(a,b){return a.power<b.power},void 0,b);f=this.renderSymbolLatex(a,e,b,a.group===q);break;case v:e=this.renderSubSymbolsLatex(a,function(a,b){return a.group<b.group},void 0,b),f=this.renderSymbolLatex(a,e,b,a.group===q);break;case u:e=this.renderSubSymbolsLatex(a,function(a,b){return a.group<b.group},!0,b),f=this.renderSymbolLatex(a,e,b);break;case q:var j=a.previousGroup;j===o&&(j=p),f=this.latex(a,b,j)}else if(M(a))for(var k=a.length,l=0;k>l;l++)f="\\left["+a.map(function(a){return ia.latex(a)}).join(" ,")+"\\right]";else f="function"==typeof a.latex?a.latex():a;return d&&(f=this.inBrackets(f)),f},renderSubSymbolsLatex:function(a,b,c,d){function e(b){for(var e,f=b.length,g="",e=0;f>e;e++){var h,i=b[e];h=i.multiplier<0?"-":c?"":"+",d=d||e>0;var k=j.latex(i,d,void 0,a.group===u&&(i.group===t||i.group===v));e>0&&(k=h+k),g+=k}return g}var f,g=a.collectSymbols().sort(b),h=g.length,i=[],j=this,k=a.group,l=.5===Math.abs(a.power);for(f=0;h>f;f++){var m=g[f];m.isInverse()&&k===u&&(i.push($(g,f).copy().invert()),f--,h--)}b&&(g.sort(b),i.sort(b));var n=e(g),i=e(i);return(k===v||k===t)&&(n&&!i&&1!==Math.abs(a.multiplier)||Math.abs(1!==a.power))&&(l||(n=ia.inBrackets(n))),i&&!n&&(n=1),i?S("\\frac{{0}}{{1}}",n,i):n},renderSymbolLatex:function(a,b,c,d){if(a.group===o)return this.latex(a,c);b=b||a.value;var e=ha.convert(a.multiplier),f=a.power||"",g=a.multiplier<0?"-":"",h=.5===f,i=f===-.5;if(c&&(g=""),e[0]=Math.abs(e[0]),I(f))f=this.latex(f,!0);else if(1===Math.abs(f)||h||i)f="";else{var j=ha.convert(f);1===j[1]&&j.pop(),a.power<0&&(j[0]=Math.abs(j[0])),f=this.fraction(j)}1===e[1]&&e.pop();var k=O(a.power)?1:0,l=/^\\frac/.test(b);if(1===e[k]){var m=e[1];if(l&&m&&1!==m){var n=aa("{","}",b,aa("{","}",b,0)[2]+1);b=Q(b,n[1],n[2],e.pop()+this.space+n[0])}e[k]=b}else if(l)for(var p=4,q=0;2>q;q++){var r=e[q],s=1!==r&&void 0!==r?r+this.space:"",t=aa("{","}",b,p);e[q]=s+t[0],p=t[2]+1}else{var u=e[k]?e[k]+this.space:"";i&&(b="\\sqrt"+this.inBraces(b)),e[k]=u+b}f&&(e[k]=this[d?"inBrackets":"inBraces"](e[k]),h||(e[k]+="^"+this.inBraces(f))),b=this.fraction(e);var v=g+b;return h&&(v="\\sqrt"+this.inBraces(v)),v},fraction:function(a){return 1===a.length?a[0]:"\\frac"+this.inBraces(a[0])+this.inBraces(a[1])},inBraces:function(a,b){return b=void 0===b?"":"$"+b,"{"+a+b+"}"},inBrackets:function(a){return"\\left("+a+"\\right)"},write2Fraction:function(a,b,c){return a.replace("$1",b).replace("$2",c)}};h.arrayPrefill=function(a,b){var c=[];b=b||0;for(var d=0;a>d;d++)c[d]=b;return c},h.prototype={custom:!0,e:function(a){return 1>a||a>this.elements.length?null:this.elements[a-1]},set:function(a,b){this.elements[a]=new d(b)},dimensions:function(){return this.elements.length},modulus:function(){return _("SAFE",function(){return k.pow(this.dot(this.copy()),new d(.5))},void 0,this)},eql:function(a){var b=this.elements.length,c=a.elements||a;if(b!==c.length)return!1;do if(Math.abs(k.subtract(this.elements[b-1],c[b-1]).valueOf())>PRECISION)return!1;while(--b);return!0},copy:function(){for(var a=new h,b=this.elements.length,c=0;b>c;c++)a.elements.push(this.elements[c].copy());return a},map:function(a){var b=[];return this.each(function(c,d){b.push(a(c,d))}),new h(b)},each:function(a){var b,c=this.elements.length,d=c;do b=d-c,a(this.elements[b],b+1);while(--c)},toUnitVector:function(){return _("SAFE",function(){var a=this.modulus();return 0===a.valueOf()?this.copy():this.map(function(b){return k.divide(b,a)})},void 0,this)},angleFrom:function(a){return _("SAFE",function(){var b=a.elements||a,c=this.elements.length;if(c!==b.length)return null;var e=new d(0),f=new d(0),g=new d(0);this.each(function(a,c){e=k.add(e,k.multiply(a,b[c-1])),f=k.add(f,k.multiply(a,a)),g=k.add(g,k.multiply(b[c-1],b[c-1]))}),f=k.pow(f,new d(.5)),g=k.pow(g,new d(.5));var h=k.multiply(f,g);if(0===h.valueOf())return null;var i=k.divide(e,h),j=i.valueOf();return-1>j&&(i=-1),j>1&&(i=1),new d(Math.acos(i))},void 0,this)},isParallelTo:function(a){var b=this.angleFrom(a).valueOf();return null===b?null:b<=PRECISION},isAntiparallelTo:function(a){var b=this.angleFrom(a).valueOf();return null===b?null:Math.abs(b-Math.PI)<=Sylvester.precision},isPerpendicularTo:function(a){var b=this.dot(a);return null===b?null:Math.abs(b)<=Sylvester.precision},add:function(a){
return _("SAFE",function(){var b=a.elements||a;return this.elements.length!==b.length?null:this.map(function(a,c){return k.add(a,b[c-1])})},void 0,this)},subtract:function(a){return _("SAFE",function(){var b=a.elements||a;return this.elements.length!==b.length?null:this.map(function(a,c){return k.subtract(a,b[c-1])})},void 0,this)},multiply:function(a){return this.map(function(b){return b.copy()*a.copy()})},x:function(a){return this.multiply(a)},dot:function(a){return _("SAFE",function(){var b=a.elements||a,c=new d(0),e=this.elements.length;if(e!==b.length)return null;do c=k.add(c,k.multiply(this.elements[e-1],b[e-1]));while(--e);return c},void 0,this)},cross:function(a){var b=a.elements||a;if(3!==this.elements.length||3!==b.length)return null;var c=this.elements;return _("SAFE",function(){return new h([_subtract(k.multiply(c[1],b[2]),k.multiply(c[2],b[1])),_subtract(k.multiply(c[2],b[0]),k.multiply(c[0],b[2])),_subtract(k.multiply(c[0],b[1]),k.multiply(c[1],b[0]))])},void 0,this)},max:function(){var a,b=0,c=this.elements.length,d=c;do a=d-c,Math.abs(this.elements[a].valueOf())>Math.abs(b.valueOf())&&(b=this.elements[a]);while(--c);return b},indexOf:function(a){var b,c=null,d=this.elements.length,e=d;do b=e-d,null===c&&this.elements[b].valueOf()===a.valueOf()&&(c=b+1);while(--d);return c},text:function(b){return a(this)},toString:function(){return this.text()},latex:function(){var a=[];for(var b in this.elements)a.push(ia.latex.call(ia,this.elements[b]));return"["+a.join(", ")+"]"}},i.identity=function(a){for(var b=new i,c=0;a>c;c++){b.elements.push([]);for(var e=0;a>e;e++)b.set(c,e,new d(c===e?1:0))}return b},i.fromArray=function(a){function b(a){return i.apply(this,a)}return b.prototype=i.prototype,new b(a)},i.zeroMatrix=function(a,b){for(var c=new i,e=0;a>e;e++)c.elements.push(h.arrayPrefill(b,new d(0)));return c},i.prototype={custom:!0,set:function(a,b,c){this.elements[a]||(this.elements[a]=[]),this.elements[a][b]=new d(c)},cols:function(){return this.elements[0].length},rows:function(){return this.elements.length},row:function(a){return!a||a>this.cols()?[]:this.elements[a-1]},col:function(a){var b=this.rows(),c=[];if(a>this.cols()||!a)return c;for(var d=0;b>d;d++)c.push(this.elements[d][a-1]);return c},eachElement:function(a){var b,c,d=this.rows(),e=this.cols();for(b=0;d>b;b++)for(c=0;e>c;c++)this.elements[b][c]=a.call(this,this.elements[b][c],b,c)},each:function(a){var b,c,d=this.rows(),e=this.cols();for(b=0;d>b;b++)for(c=0;e>c;c++)a(this.elements[b][c],b,c)},determinant:function(){if(!this.isSquare())return null;var a,b=this.toRightTriangular(),c=b.elements[0][0],d=b.elements.length-1,e=d;do a=e-d+1,c=k.multiply(c,b.elements[a][a]);while(--d);return c},isSquare:function(){return this.elements.length===this.elements[0].length},isSingular:function(){return this.isSquare()&&0===this.determinant()},augment:function(a){var b=this.rows(),c=a.rows();if(b!==c)throw new Error("Cannot augment matrix. Rows don't match.");for(var d=0;b>d;d++)this.elements[d]=this.elements[d].concat(a.elements[d]);return this},copy:function(){for(var a=this.rows(),b=this.cols(),c=new i,d=0;a>d;d++){c.elements[d]=[];for(var e=0;b>e;e++){var f=this.elements[d][e];c.elements[d][e]=I(f)?f.copy():f}}return c},invert:function(){return this.isSquare()||E("Matrix is not square!"),_("SAFE",function(){var a,b,c,d,e,f,g,h=this.elements.length,j=h,l=this.augment(i.identity(h)).toRightTriangular(),m=l.elements[0].length,n=[];do{a=h-1,e=[],c=m,n[a]=[],f=l.elements[a][a];do d=m-c,g=k.divide(l.elements[a][d],f.copy()),e.push(g),d>=j&&n[a].push(g);while(--c);for(l.elements[a]=e,b=0;a>b;b++){e=[],c=m;do d=m-c,e.push(k.subtract(l.elements[b][d],k.multiply(l.elements[a][d],l.elements[b][a])));while(--c);l.elements[b]=e}}while(--h);return i.fromArray(n)},void 0,this)},toRightTriangular:function(){return _("SAFE",function(){var a,b,c,e,f,g,h=this.copy(),i=this.elements.length,j=i,l=this.elements[0].length;do{if(e=j-i,b=h.elements[e][e],0===b.valueOf())for(var m=e+1;j>m;m++)if(c=h.elements[m][e],c&&0!==c.valueOf()){a=[],f=l;do g=l-f,a.push(k.add(h.elements[e][g].copy(),h.elements[m][g].copy()));while(--f);h.elements[e]=a;break}var b=h.elements[e][e];if(0!==b.valueOf())for(m=e+1;j>m;m++){var n=k.divide(h.elements[m][e].copy(),h.elements[e][e].copy());a=[],f=l;do g=l-f,a.push(e>=g?new d(0):k.subtract(h.elements[m][g].copy(),k.multiply(h.elements[e][g].copy(),n.copy())));while(--f);h.elements[m]=a}}while(--i);return h},void 0,this)},transpose:function(){var a,b,c,d=this.elements.length,e=this.elements[0].length,f=new i,g=e;do{a=e-g,f.elements[a]=[],b=d;do c=d-b,f.elements[a][c]=this.elements[c][a].copy();while(--b)}while(--g);return f},canMultiplyFromLeft:function(a){var b=K(a)?a.elements.length:a.length;return this.elements[0].length===b},multiply:function(a){return _("SAFE",function(){var b=a.elements||a;if(!this.canMultiplyFromLeft(b))return null;var c,e,f,g,h,j,l=this.elements.length,m=l,n=b[0].length,o=this.elements[0].length,p=[];do{c=m-l,p[c]=[],e=n;do{f=n-e,g=new d(0),h=o;do j=o-h,g=k.add(g,k.multiply(this.elements[c][j],b[j][f]));while(--h);p[c][f]=g}while(--e)}while(--l);return i.fromArray(p)},void 0,this)},toVector:function(){if(1===this.rows()||1===this.cols()){var a=new h;return a.elements=this.elements,a}return this},toString:function(a){var b=this.rows(),c=[];a=void 0===a?"\n":a;for(var d=0;b>d;d++)c.push("["+this.elements[d].map(function(a){return void 0!==a?a.toString():""}).join(",")+"]");return c.join(","+a)},text:function(){return"matrix("+this.toString("")+")"},latex:function(){var a=this.cols(),b=this.elements;return S("\\begin{vmatrix}{0}\\end{vmatrix}",function(){var c=[];for(var d in b){for(var e=[],f=0;a>f;f++)e.push(ia.latex.call(ia,b[d][f]));c.push(e.join(" & "))}return c.join(" \\cr ")})}};var ja=function(){Z(k.constants),Z(k.functions)},ka=m.build=function(b,c){var d=W(b),e=[],f=function(b,c){c=c||[];var d=[],g=b.group,h="",i=function(a){var d=a===u?"*":"+",e=[];for(var g in b.symbols)e.push(f(b.symbols[g],c)[0]);var h=e.join(d);return h?P(h):h},j=function(a){var d,g=!1,h=P(b.args.map(function(a){return f(a,c)[0]}));if(a in Math)d="Math."+a;else{if(-1===e.indexOf(a))if(void 0!=ga[a])c.push("var "+a+" = "+ga[a].toString()+"; "),e.push(a);else{g=!0;var i="";for(var j in la)void 0!=la[j][a]&&(i=j);""!=i?(c.push("var "+a+" = nerdamer(nerdamer.getCore()."+i+"."+a+h+".toString()).valueOf(); "),e.push(a)):c.push("var "+a+" = 0;")}d=a}return g?d=a:d+=P(b.args.map(function(a){return f(a,c)[0]}).join(",")),d};g===o?d.push(b.multiplier):-1===b.multiplier?h="-":1!==b.multiplier&&d.push(b.multiplier);var k=null;if(g===p)k=b.value;else if(g===r)k=j(b.baseName);else if(g===q){var l=b.previousGroup;k=l===o||l===p?b.value:l===r?j(b.baseName):i(b.previousGroup)}else k=i(b.group);return void 0!==b.power&&1!==b.power&&(k="Math.pow"+P(k+","+a(b.power))),k&&d.push(h+k),[d.join("*"),c.join("").replace(/\n+\s+/g," ")]};if(c){d.length!==c.length&&E("Argument array contains wrong number of arguments");for(var g=0;g<d.length;g++){var h=d[g];-1===c.indexOf(h)&&E(h+" not found in argument array")}d=c}var i=f(b);return new Function(d,i[1]+" return "+i[0]+";")};ja();var la={};la.groups=l,la.Symbol=d,la.Expression=c,la.Vector=h,la.Matrix=i,la.Parser=g,la.Fraction=ha,la.Math2=ga,la.Latex=ia,la.Utils=m,la.PARSER=k,la.PARENTHESIS=w,la.Settings=n,la.VARS=B,la.err=E;var ma=function(a,b,d,e){var f,g,h;a=ca(a),a instanceof c&&(a=a.toString());var i=a.split("=");i.length>1&&(/\w+\((.*)\)/.test(i[0].replace(/\s/g,""))?(g=/\w+(?=\()/.exec(i[0])[0],h=/\((.*)(?=\))/.exec(i[0])[1].replace(/\s/g,"").split(",")):f=i[0],a=i[1]),("string"==typeof d||d instanceof String)&&void 0!==d&&-1!==d.indexOf("numer")&&(b=null==b?{}:b,b.PI=Math.PI,b.E=Math.E);var j=M(d),l="expand",m=j?-1!==d.indexOf("numer"):"numer"===d;(j?-1!==d.indexOf(l):d===l)&&"undefined"!=typeof la.Algebra.expand&&(a=S("{0}({1})",l,a));var o=_("PARSE2NUMBER",function(){return k.parse(a,ba(b))},m||n.PARSE2NUMBER);return e?A[e-1]=o:A.push(o),f&&ma.setVar(f,o),g&&ma.setFunction(g,h,o),new c(o)};return ma.version=function(){return j},ma.setConstant=function(a,b){if(F(a),!D(a))if("delete"===b)delete k.constants[a];else{if(isNaN(b))throw new Error("Constant must be a number!");k.constants[a]=b}return this},ma.setFunction=function(a,b,c){return F(a),D(a)?!1:(b=b||W(k.parse(c)),k.functions[a]=[k.mapped_function,b.length,{name:a,params:b,body:c}],!0)},ma.getCore=function(){return la},ma.getExpression=ma.getEquation=c.getExpression,ma.reserved=function(a){return a?C:C.join(", ")},ma.clear=function(a,b){if("all"===a)A=[];else if("last"===a)A.pop();else if("first"===a)A.shift();else{var c=a?a-1:A.length;b===!0?A[c]=void 0:$(A,c)}return this},ma.expressions=function(b,c){for(var d=b?{}:[],e=0;e<A.length;e++){var f=c?ia.latex(A[e]):a(A[e]);b?d[e+1]=f:d.push(f)}return d},ma.register=function(a){var b=this.getCore();if(M(a))for(var c=0;c<a.length;c++)a&&this.register(a[c]);else if(a&&-1===n.exclude.indexOf(a.name)){if(a.dependencies)for(var c=0;c<a.dependencies.length;c++)if(!b[a.dependencies[c]])throw new Error(S("{0} requires {1} to be loaded!",a.name,a.dependencies[c]));var d=a.parent,e=a.build.call(b);if(d){b[d]||(b[a.parent]={});var f="nerdamer"===d?this:b[d];f[a.name]=e}a.visible&&(k.functions[a.name]=[e,a.numargs])}},ma.validateName=F,ma.supported=function(){return T(k.functions)},ma.numEquations=ma.numExpressions=function(){return A.length},ma.setVar=function(a,b){return F(a),"delete"===b?delete B[a]:B[a]=I(b)?b:k.parse(b),this},ma.clearVars=function(){return B={},this},ma.getVars=function(a){a=a||"text";var b={};if("object"===a)b=B;else for(var c in B)"latex"===a?b[c]=B[c].latex():"text"===a&&(b[c]=B[c].text());return b},ma.addPreprocessor=function(a){return z.push(a)},ma.removePreprocessor=function(a){a===z.length&&z.pop(),z.splice(a-1,1,void 0)},ma.set=function(a,b){var c=["SAFE"];-1!==c.indexOf(a)&&E("Cannot modify setting: "+a),n[a]=b},ma}();"undefined"!=typeof module&&(module.exports=nerdamer);
